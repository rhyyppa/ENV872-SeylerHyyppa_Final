---
title: "EDA Final Report Spring 2022"
author: "Reino Hyyppa & Meghan Seyler"
date: "4/19/2022"
output: pdf_document
---

Reminders for knitting commands in code chunks - can delete when we're done

* Knitting commands in code chunks:
 - `include = FALSE` - code is run, but neither code nor results appear in knitted file
 - `echo = FALSE`    - code not included in knitted file, but results are
 - `eval = FALSE`    - code is not run in the knitted file
 - `message = FALSE` - messages do not appear in knitted file
 - `warning = FALSE` - warnings do not appear...
 - `fig.cap = "..."` - adds a caption to graphical results

# 1. Introduction 

## 1.1 Context 

Waste diversion comes with global benefits including a decrease in  
global warming potential (GWP). However, waste diversion stands to especially 
benefit those populations living closest to landfills by decreasing local 
green house gas emissions and other hazards such as odor, smoke, noise, and  
water contamination.This project aims to identify which populations live closest
to construction and demolition landfills in North Carolina and therefore which 
populations stand to benefit the most from waste diversion in the construction 
industry. The focus on the construction industry was inspired by one of the 
group member's masters project which is focused on circularity and waste 
diversion in the construction industry. 


## 1.2 Research Question
Are construction and demolition landfills in North Carolina disproportionately  
located in counties with high minority and/or low income populations? 

Are construction and demolition landfills in North Carolina disproportionately  
located in census tracts with high minority and/or low income populations?  

## 1.3 Rational for Data 
To investigate the research question we used three data sets: 

1. North Carolina Department of Environmental Quality Site Waste Facility data.  
This data set contains the addresses of each of the construction and 
demolition landfills in North Carolina. We chose this data set so that we could 
geocode the addresses into coordinates and map the landfills. 

2. CDC Social Vulnerability 2014-2018 data. This data set gave us the total  
population of each county and census tract as well as the number of minority   
residents and residents below the poverty line per county and per tract.  
Additionally, this data set was chosen because this data set has both location,  
via FIPS code, and SVI data it could be used to create a heat map of poverty and 
minority data by county. 

3. USA Counties Shape File from U.S. Census. This data set was chosen because it  
is the spatial dataframe needed to establish the map of North Carolina using the 
mapview function. 


# 2 Dataset Information 

## 2.1 Source and Content of Data

The source and general description of each data set are outlined in Table 1  
below. The variables of interest for each data set our outlined in Table 2 and 3.  
The variables in bold are variables that we created during the wrangling process.

**TABLE 1: Data set Description and Sources**

Dataset Names | Relevant Information | Source |
------------- | ---------------------| -----
Site Waste Facility  | Lists all landfills in NC and includes landfill type and address. | NC DEQ   https://deq.nc.gov/about/divisions/waste-management/solid-waste-section/solid-waste-facility-lists-presentations-and-annual-reports/solid-waste-facility-lists
CDC Social Vulnerability | Contains estimates of poverty and minority data by county. | Agency for Toxic Substances and Disease Registry https://www.atsdr.cdc.gov/placeandhealth/svi/documentation/SVI_documentation_2018.html
USA Counties Shape File | Spatial data frame that will establish the map of NC. | US Census   https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html

**TABLE2: Relevant SVI Data Variables**
SVI Variable Name | Variable Description | Units
-------|--------------|-------|
E_TOTPOP  | Population estimate,2014-2018 ACS | Count
E_POV     | Persons below poverty estimate,2014-2018 ACS | Count      
E_MINRTY  | Minority estimate (all persons except white,non-Hispanic),2014-2018 ACS | Count
**POV_Percent**   | **(E_POV/E_TOTPOP)x100** | **Percentage**
**MINRTY_Percent**| **(E_MINRTY/E_TOTPOP)x100** | **Percentage**   

**TABLE3: Relevant Site Waste Facility Variables**
Landfill Location Variable Name | Variable Description 
-------|--------------|
Address3 | Landfill street name and area code 
City    | City name 
State     | State acronym  
**lat**       | **Landfill latitude** 
**long** | **Landfill longitude**

######### For processed data only: add table with dataset dimensions etc.This would be a table of column names and the data types, eg numeric, character,etc. Could be included with a list of mean values, missing data counts, etc

## 2.2 Wrangling Process

1. North Carolina Department of Environmental Quality Site Waste Facility data.  
    + Filter for only construction and demolition landfills 
    + use geocode function to turn addresses into latitude and longitude 
    + identify sites with N/As and inocorrect coordinates 
    + manually make an excel sheet with the pesky addresses and coordinates
    + merge the the original data set with the manually generate data set 
    
2. 

```{r include=FALSE, warning = FALSE}
#examine working directory
getwd()

#loading packages for spatial analysis 
library(tidyverse)
library(sf)
library(leaflet)
library(mapview)
library(RColorBrewer)
library(dplyr)
library(lubridate)

#loading packages for geocoding
#install.packages("tidygeocoder")
library(tidygeocoder)
library(tibble)
library(dplyr)

#loading packages for exploratory analysis 
library(knitr)
library(ggplot2)

```

```{r}
#import SVI tract-level data and change FIPS from character to factor 
svi2018_nc_tract_st <-st_read('./Data/Spatial/NorthCarolinaTract/SVI2018_NORTHCAROLINA_tract.shp')
svi2018_nc_tract_st$FIPS<-as.factor(svi2018_nc_tract_st$FIPS)
  
#mapview(svi2018_nc_tract_st)

#import and select columns of interest from SVI county data and change FIPS from character to factor
svi2018_nc_raw <- read.csv(
  'https://svi.cdc.gov/Documents/Data/2018_SVI_Data/CSV/States_Counties/NorthCarolina_COUNTY.csv',
  colClasses = c('FIPS' = 'factor')) %>% 
  select(COUNTY, FIPS, LOCATION, E_TOTPOP, E_POV, E_MINRTY)

```


# 3 Exploratory Analysis
(Rubric: flow between text and visualization is cohesive & relevant exploratory information is visualized)

Once the two data sets had been processed and converted into a spatial data frame, we conducted an exploratory analysis of our data visually using maps to display counties and census tracts for the state of North Carolina. We also created a map displaying the locations of construction and demolition landfills in North Carolina. Maps and visual analysis of the data was performed using 'ggplot' and the 'mapview' package.

```{r fig.cap = Map of North Carolina Counties}
counties_sf<- st_read('./Data/Spatial/cb_2018_us_county_20m.shp') %>% 
  filter(STATEFP == 37) 

mapview(counties_sf)

```

```{r fig.cap= Map of North Cnesus Tracts, echo=F}

mapview(svi2018_nc_tract_st)

```


Additionally, we calculated the rate of minority and poverty in each county as a percent of total population to analyze the distribution of this data across North Carolina. We did this by dividing the total population by the number of low-income or minority households in each county. Then we created a chart of the top 10 counties ranked by rates of poverty and minority. We performed the same exploratory analysis on census tracts to provide a more localized and higher-resolution analysis of how this data is distributed across the state. Based on our calculations Robeson county, located in the southern part of the state, had the highest poverty and minority rates for North Carolina. 

```{r explore svi data, include=FALSE}
#check structure
#str(svi2018_nc_raw)

#check colnames
#colnames(svi2018_nc_raw)

#investigate what location column includes
#glimpse(svi2018_nc_raw$LOCATION)

#create percent poverty and minority values by county to explore which county's have the highest percentage minority and poverty populations 
povdividedbytotal_col<-(svi2018_nc_raw$E_POV/svi2018_nc_raw$E_TOTPOP)*100

minrtydividedbytotal_col<-(svi2018_nc_raw$E_MINRTY/svi2018_nc_raw$E_TOTPOP)*100

#add the percentage columns to the raw data
svi2018_nc_processed<-svi2018_nc_raw%>%
  add_column(Percent_POV = povdividedbytotal_col)%>%
  add_column(Percent_MINRTY = minrtydividedbytotal_col)

svi2018_nc_poverty_top10 <- svi2018_nc_processed %>%
    arrange(desc(Percent_POV))%>%
    slice(1:10)%>%
    relocate(Percent_POV, .before = FIPS)

view(svi2018_nc_poverty_top10)

svi2018_nc_minrty_top10 <- svi2018_nc_processed %>%
    arrange(desc(Percent_MINRTY))%>%
    slice(1:10)%>%
   relocate(Percent_MINRTY, .before = FIPS)

#create percent poverty and minority values by tract to explore which tracts have the highest minority and poverty populations by percentage 

povdividedbytotal_tract_col<-(svi2018_nc_tract_st$E_POV/svi2018_nc_tract_st$E_TOTPOP)*100

minrtydividedbytotal_tract_col<-(svi2018_nc_tract_st$E_MINRTY/svi2018_nc_tract_st$E_TOTPOP)*100

svi2018_nc_tract_st<-svi2018_nc_tract_st%>%
  add_column(Percent_POV = povdividedbytotal_tract_col)%>%
  add_column(Percent_MINRTY = minrtydividedbytotal_tract_col)

svi2018_nc_tract_st<-svi2018_nc_tract_st%>%
  select(COUNTY, FIPS, LOCATION, E_TOTPOP, E_POV, E_MINRTY,Percent_POV,Percent_MINRTY)

svi2018_nc_tract_st_top10 <- svi2018_nc_tract_st %>%
    arrange(desc(Percent_POV))%>%
    slice(1:10)%>%
    relocate(Percent_POV, .before = FIPS)

svi2018_nc_tract_st_top10 <- svi2018_nc_tract_st %>%
    arrange(desc(Percent_MINRTY))%>%
    slice(1:10)%>%
   relocate(Percent_MINRTY, .before = FIPS)

```


```{r fig.cap= Table of Top 10 Counties Ranked by Percent Poverty}
knitr::kable(head(svi2018_nc_poverty_top10[1:10,1:2]), 
             "simple", 
             col.names = c("County","Poverty Percentage"),
             align = 'c',
             caption = "Counties by Highest Poverty Percentage in North Carolina"
)
```

```{r fig.cap= Table of Top 10 Counties Ranked by Percent Minority}
knitr::kable(head(svi2018_nc_minrty_top10[1:10,1:2]), 
             "simple", 
             col.names = c("County","Minority Percentage"),
             align = 'c',
             caption = "Counties by Highest Percentage of Minority Populations in North Carolina"
) 
```

Finally, we created two separate lollipop plots using the 'ggplot' package to visualize and explore the relationship between counties and poverty and minority populations as a percent of total population for each county. 


```{r exploration plots, fig.cap = "By Meghan Seyler and Reino Hyyppa"}
poverty_plot<-svi2018_nc_processed%>%
  arrange(Percent_POV)%>%
  mutate(COUNTY=factor(COUNTY, COUNTY))%>%
    ggplot(aes(x=COUNTY, y=Percent_POV)) +
      geom_point(color="lightgreen") + 
      geom_segment( aes(x=COUNTY, xend=COUNTY, y=0, yend=Percent_POV))+
      coord_flip()+
      ggtitle("Percentage of Poverty by County in North Carolina") +
      xlab("County Name")+
      ylab("Poverty Population Percentage")+
      theme_minimal()+
      theme(
        axis.text = element_text(size = 5, face='bold', angle = 30, hjust = 1, vjust =0.5) ,
        panel.grid.major.y = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
  )

poverty_plot

minority_plot<-svi2018_nc_processed%>%
  arrange(Percent_MINRTY)%>%
  mutate(COUNTY=factor(COUNTY, COUNTY))%>%
    ggplot(aes(x=COUNTY, y=Percent_MINRTY)) +
      geom_point(color="69b3a2") + 
      geom_segment( aes(x=COUNTY, xend=COUNTY, y=0, yend=Percent_MINRTY))+
      coord_flip()+
      ggtitle("Percentage of Minority Populations by County in North Carolina") +
      xlab("County Name")+
      ylab("Minority Population Percentage")+
      theme_minimal()+
      theme(
        axis.text = element_text(size = 5, face='bold'),
        panel.grid.major.y = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        plot.subtitle = element_text("By Reino Hyyppa and Meghan Seyler"),
  )
minority_plot
```


# 4 Analysis

## 4.1 Q1: Are construction and demolition landfills in North Carolina disproportionately located in counties with high minority and/or low income populations? 

We conducted a visual analysis of the relationship between 


Are construction and demolition landfills in North Carolina disproportionately  
located in census tracts with high minority and/or low income populations?

