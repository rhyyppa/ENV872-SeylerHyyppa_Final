---
title: "SeylerHyyppa_FinalProject_dataanalysis"
author: "Meghan Seyler"
date: "4/3/2022"
output: html_document
editor_options: 
  chunk_output_type: console
---

# 4 Analysis 


```{r analyze data}

landfill_sites <- read.csv("../ENV872-SeylerHyyppa_Final/Data/Processed/SW_FacilityList_processed.csv", stringsAsFactors = TRUE)

head(landfill_sites)
dim(landfill_sites)

#Convert to a spatial dataframe
landfill_sites_sf <- landfill_sites %>% 
  st_as_sf(coords = c('long','lat'),
           crs=4326)

landfill_sf_utm <- st_transform(landfill_sites_sf, crs = 26917)

# view using ggplot
ggplot(data = landfill_sites_sf) + geom_sf()

#View using mapview
mapview(landfill_sites_sf)

```


# 5 Visualization
```{r join.attributes.to.spatial features county level}

#View minortiy and poverty counts with mapview
mapview(counties_sf_svi_processed, 
        zcol = 'E_POV', 
        col.regions = brewer.pal(2, 'RdBu')) + 
  mapview(landfill_sites_sf, cex = 3, col.regions="green")

mapview(counties_sf_svi_processed, 
        zcol = 'E_MINRTY', 
        col.regions = brewer.pal(2, 'RdBu')) + 
  mapview(landfill_sites_sf, cex = 3, col.regions="green")

#view minority and poverty percentages with mapview
mapview(counties_sf_svi_processed, 
        zcol = 'Percent_POV', 
        col.regions = brewer.pal(2, 'RdBu')) + 
  mapview(landfill_sites_sf, cex = 3, col.regions="green")

mapview(counties_sf_svi_processed, 
        zcol = 'Percent_MINRTY', 
        col.regions = brewer.pal(2, 'RdBu')) + 
  mapview(landfill_sites_sf, cex = 3, col.regions="green")

```

```{r join.attributes.to.spatial features tract level}


#View minortiy and poverty counts with mapview
mapview(svi2018_nc_tract_st, 
        zcol = 'E_POV', 
        col.regions = brewer.pal(2, 'RdBu')) + 
  mapview(landfill_sites_sf, cex = 3, col.regions="green")

mapview(svi2018_nc_tract_st, 
        zcol = 'E_MINRTY', 
        col.regions = brewer.pal(2, 'RdBu')) + 
  mapview(landfill_sites_sf, cex = 3, col.regions="green")

#view minority and poverty percentages with mapview
mapview(svi2018_nc_tract_st, 
        zcol = 'Percent_POV', 
        col.regions = brewer.pal(2, 'RdBu')) + 
  mapview(landfill_sites_sf, cex = 3, col.regions="green", alpha = 1)

mapview(svi2018_nc_tract_st, 
        zcol = 'Percent_MINRTY', 
        col.regions = brewer.pal(2, 'RdBu')) + 
  mapview(landfill_sites_sf, cex = 3, col.regions="green")



```

```{r spatial overlap analysis}

#Convert to UTM Zone 17 (crs = 26917)
counties_sf_utm <- st_transform(counties_sf_svi_processed, crs = 26917)

#Start building a map object
myMap = mapview(counties_sf_utm, 
                col.regions = 'yellow', 
                alpha.regions = 0.2,
                map.types = "CartoDB.Positron",
                legend = FALSE)
#Show the map
myMap

mapview(counties_sf_utm)

#Select intersecting counties using the `filter()` command
counties_intersect_2 <- counties_sf_utm %>% 
  filter(st_intersects(x = ., y = landfill_sf_utm, sparse = TRUE))

#View the result
myMap + mapview(counties_intersect_2, alpha.regions = 0)

#Actually intersect the counties (not just select those that intersect)
neuse_counties_sf <- neuse_sf %>% 
  st_intersection(counties_sf_utm)
myMap + mapview(neuse_counties_sf, alpha.regions = 0)

# testing alternative intersection approach 
intersection.test <- st_intersection(counties_sf_utm, landfill_sf_utm, sparse=FALSE)
mapview(intersection.test)
```

# 6 Summary and Conclusions


To Do: 
# Shorten name of counties_sf_svi_processed
# change size of landfill bubbles
# st_intersects() to return list of 
