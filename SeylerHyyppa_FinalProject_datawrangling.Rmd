---
title: "SeylerHyyppa_FinalProject_datawrangling"
author: "Reino Hyyppa & Meghan Seyler"
date: "3/31/2022"
output: html_document
---
Reminders for knitting commands in code chunks - can delete when we're done

* Knitting commands in code chunks:
 - `include = FALSE` - code is run, but neither code nor results appear in knitted file
 - `echo = FALSE`    - code not included in knitted file, but results are
 - `eval = FALSE`    - code is not run in the knitted file
 - `message = FALSE` - messages do not appear in knitted file
 - `warning = FALSE` - warnings do not appear...
 - `fig.cap = "..."` - adds a caption to graphical results

# 1. Introduction 

## 1.1 Context 

Waste diversion comes with global benefits including a decrease in  
global warming potential (GWP). However, waste diversion stands to especially 
benefit those populations living closest to landfills by decreasing local 
green house gas emissions and other hazards such as odor, smoke, noise, and  
water contamination.This project aims to identify which populations live closest
to construction and demolition landfills in North Carolina and therefore which 
populations stand to benefit the most from waste diversion in the construction 
industry. The focus on the construction industry was inspired by one of the 
group member's master's project which is focused on circularity and waste 
diversion in the construction industry. 


## 1.2 Research Question
Are construction and demolition landfills in North Carolina disproportionately  
more common in low income counties and/or counties with high minority  
populations?

## 1.3 Rational for Data 

####### what's the difference between this and section 2?

# 2 Dataset Information 

## 2.1 Source and Content of Data

########does this also count as table with dataset structure? Meghan askin John on 4/1

Dataset Names | Relevant Information | Source |
------------- | ---------------------| -----
Site Waste Facility  | Lists all landfills in NC and includes landfill type and address. | NC DEQ   https://deq.nc.gov/about/divisions/waste-management/solid-waste-section/solid-waste-facility-lists-presentations-and-annual-reports/solid-waste-facility-lists
CDC Social Vulnerability | Contains estimates of poverty and minority data by county. | Agency for Toxic Substances and Disease Registry https://www.atsdr.cdc.gov/placeandhealth/svi/documentation/SVI_documentation_2018.html
USA Counties Shape File | Spatial data frame that will establish the map of NC. | US Census   https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html

## 2.2 Wrangling Process

```{r include=FALSE, warning = FALSE}
#examine working directory
getwd()

#loading packages for spatial analysis 
library(tidyverse)
library(sf)
library(leaflet)
library(mapview)
library(RColorBrewer)
library(dplyr)
library(lubridate)

#loading packages for geocoding
#install.packages("tidygeocoder")
library(tidygeocoder)
library(tibble)
library(dplyr)

```


```{r data.loading.wrangling warning=FALSE}
#read in Landfill location raw data filter by waste type
SW_FacilityList_CD <- read_csv('./Data/Raw/SW_FacilityList_Col_A3.csv')%>%
  filter(Waste_Type == 'CD')

<<<<<<< HEAD
=======
head(SW_FacilityList_CD)

svi2018_nc_raw_full <- read.csv(
  'https://svi.cdc.gov/Documents/Data/2018_SVI_Data/CSV/States_Counties/NorthCarolina_COUNTY.csv')

>>>>>>> f19002ea911171d77895ff16c3af80aa3625d81e
#read in social vulnerability raw data 
#Read the 2018 SVI county-level dataset for NC
svi2018_nc_raw <- read.csv(
  'https://svi.cdc.gov/Documents/Data/2018_SVI_Data/CSV/States_Counties/NorthCarolina_COUNTY.csv',
  colClasses = c('FIPS' = 'factor')) %>% 
  select(COUNTY, FIPS, LOCATION, E_TOTPOP, E_POV, E_MINRTY)

#Read in USA counties shapefile and filter for just NC - stateFP 37
counties_sf<- st_read('./Data/Spatial/cb_2018_us_county_20m.shp') %>% 
  filter(STATEFP == 37) 

```

geocode function extract addresses from the input dataframe and pass this data to the geo function which executest he geocoding queries. All extra arguments (...) given to geocode() are passed to geo() 
```{r geocoding}
#using site waste facility address to add latitude and longitude to sW_Facility_List_CD datafra
SW_FacilityList_CD_geo<-geo(
  address = SW_FacilityList_CD$Address3, method = "osm",
  lat = latitude, long = longitude
)
?geo()
head(SW_FacilityList_CD_geo)
#making data frame to manually input latitude and longitude for two addresses
address<-c("172 Landfill Rd NE", 	"40592b Stony Gap Road")
latitude<-c(34.04426,35.31502)
longitude<-c(-78.25620,-80.15286)
SW_missing_df<-data.frame(address,latitude,longitude)

#merging geo dataframe with manual dataframe and removing the NA rows
SW_Facility_CD_geo_merge<-rbind(SW_FacilityList_CD_geo,SW_missing_df, by=c("address","longitude","latitude"))
SW_Facility_processed<- SW_Facility_CD_geo_merge %>% slice(-c(6,64,82))

#join 
SW_Facility_processed <- SW_Facility_processed %>% 
  left_join(SW_FacilityList_CD, by = c("address" = "Address3"))

#writing csv to save wrangled data as a csv in processed folder 
write.csv(SW_Facility_processed, row.names = FALSE, file = "Z:/ENV872/ENV872-SeylerHyyppa_Final/Data/Processed/SW_Facility_Processed.csv")

```

```{r joinging.dataframes}
#join counties sf and svi dataframe
counties_sf_svi <- counties_sf %>% 
  left_join(svi2018_nc_raw, by = c("GEOID" = "FIPS"))

counties_sf_svi_SW_join <- counties_sf_svi %>% 
  left_join(SW_Facility_processed, by = c("NAME" = "County.y"))

```


# 3 Exploratory Analysis
(Rubric: flow between text and visualization is cohesive & relevant exploratory information is visualized)

```{r analyze data}

landfill.sites <- read.csv("../ENV872-SeylerHyyppa_Final/Data/Processed/SW_Facility_Processed.csv", stringsAsFactors = TRUE)

head(landfill.sites)

#Convert to a spatial dataframe
landfill.sf <- landfill.sites %>% 
  st_as_sf(coords = c('longitude','latitude'),
           crs=4326)

# view using ggplot
ggplot(data = landfill.sf) + geom_sf()

#View using mapview
mapview(landfill.sf)

```
# 4 Analysis 

# 5 Visualization

# 6 Summary and Conclusions



